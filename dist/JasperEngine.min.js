/*! JasperEngine 19-06-2013 */
function hasOwnProperty(a,b){var c=a.__proto__||a.constructor.prototype;return b in a&&(!(b in c)||c[b]!==a[b])}var Jasper=function(){};if(Object.prototype.hasOwnProperty)var hasOwnProperty=function(a,b){return a.hasOwnProperty(b)};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),Object.extend=function(a,b){for(var c in b)a[c]=b[c];return a},Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Jasper.Behavior=function(){this._parent=null},Jasper.Behavior.prototype.init=function(){},Jasper.Behavior.prototype.update=function(){},Jasper.Behavior.prototype.getParentObject=function(){return this._parent},Jasper.Behavior._createBehavior=function(a,b){var c=new Jasper.Behavior;Object.extend(c,b);var d=function(){};return d.prototype=c,Object.extend(d.prototype,b),d},Jasper.RenderableBehavior=function(){},Jasper.RenderableBehavior.prototype=new Jasper.Behavior,Jasper.RenderableBehavior.prototype.renderBefore=function(a){a.save()},Jasper.RenderableBehavior.prototype.renderAfter=function(a){a.restore()},Jasper.RenderableBehavior.prototype.render=function(){},Jasper.RenderableBehavior._createRenderBehavior=function(a,b){var c=new Jasper.RenderableBehavior;Object.extend(c,b);var d=function(){};return d.prototype=c,Object.extend(d.prototype,b),d},Jasper.BehaviorManager=function(){this._beh_BehObjPairs={},this._name_beh={circle:Jasper.CircleDrawBehavior,rect:Jasper.RectangleDrawBehavior,testmove:Jasper.RandomMoveBehavior,mouse:Jasper.MouseBehavior},this._nonUpdateBehaviors=["mouse"]},Jasper.BehaviorManager.prototype={_addBehaviorToObject:function(a,b){if("string"==typeof a){if(hasOwnProperty(this._name_beh,a)){var c=new this._name_beh[a];return void 0===this._beh_BehObjPairs[a]&&(this._beh_BehObjPairs[a]=[]),this._beh_BehObjPairs[a].push([c,b]),console.log("returning behavior",c),"undefined"==typeof c.init&&(c.prototype.init=function(){}),c.init(b),c}return console.log("Behavior "+a+" has not been registered to JasperCore"),console.log("returning null"),null}},_createBehavior:function(a,b){return"string"==typeof a?hasOwnProperty(this._name_beh,a)?(console.log("Behavior name already present : "+a),null):(this._name_beh[a]=b,a):void 0},_deleteBehaviorFromObject:function(a,b){if(void 0!==this._beh_BehObjPairs[a])for(var c=this._beh_BehObjPairs[a].length,d=0;c>d;d++)if(this._beh_BehObjPairs[a][d][1].__obj_id==b.__obj_id)return this._beh_BehObjPairs[a].splice(d,1),void 0},_isNonUpdateBehavior:function(a){for(var b=this._nonUpdateBehaviors.length,c=0;b>c;c++)if(this._nonUpdateBehaviors[c]==a)return!0;return!1},_addNonUpdateBehavior:function(a){this._isNonUpdateBehavior(a)||this._nonUpdateBehaviors.push(a)},_getAllBehaviors:function(){var a=[];for(var b in this._name_beh)a.push(b);return a},_getBehArray:function(){return this._beh_BehObjPairs}},Jasper.Core=function(){this.fps=60,this.running=!1,this.lastTime=0,this.canvas=null,this.canvasWidth=0,this.canvasHeight=0,this.canvasContext=null,this.scenes=[],this.activeScene=null,this.__next_objid=1,this.onInit=function(){}},Jasper.Core.prototype={_createCanvas:function(a,b){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvasWidth=a,this.canvas.height=this.canvasHeight=b,this.canvas.onmousemove=function(a){Jasper._mouseManager.mouseMove(a)},this.canvas.onmousedown=Jasper._mouseManager.mouseDown.bind(Jasper._mouseManager),this.canvas.onmouseup=Jasper._mouseManager.mouseUp.bind(Jasper._mouseManager),this.canvas.onclick=Jasper._mouseManager.mouseClick.bind(Jasper._mouseManager),this.canvas.ondblclick=Jasper._mouseManager.mouseDblClick.bind(Jasper._mouseManager),this.canvasContext=this.canvas.getContext("2d"),document.getElementById("container").appendChild(this.canvas)},_render:function(){this.canvasContext.save(),this.canvasContext.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.activeScene._render(this.canvasContext),this.canvasContext.restore()},_update:function(){currTime=(new Date).getTime(),elapsedTime=currTime-this.lastTime,this.lastTime=currTime,this.running&&requestAnimFrame(this._update.bind(this)),this.activeScene instanceof Jasper.Scene&&(this.activeScene._update(elapsedTime),Jasper._mouseManager._activateCallbacks(),this._render())},_start:function(){this.onInit(),this.lastTime=(new Date).getTime(),this.running=!0,requestAnimFrame(this._update.bind(this))},_getBehaviorManager:function(){return Jasper._behaviorManager},init:function(a){Jasper._mouseManager=new Jasper.Mouse,Jasper._behaviorManager=new Jasper.BehaviorManager,this._createCanvas(a.width,a.height),this.setFps(a.fps||30),Jasper._core=this,this._start()},getCanvas:function(){return this.canvas},getMouseManager:function(){return Jasper._mouseManager},addScene:function(a){-1==this.scenes.indexOf(a)&&this.scenes.push(a)},removeScene:function(a){if(this.activeScene==a)return console.log("Trying to remove currently active scene not permitted."),void 0;var b=this.scenes.indexOf(a);-1!=b&&this.scenes.splice(b,1)},removeSceneByName:function(a){if(this.activeScene.getSceneName()==a)return console.log("Trying to remove currently active scene not permitted."),void 0;for(var b=0;b<this.scenes.length;b++)this.scenes.getSceneName()==a&&this.scenes.splice(b,1)},getScenes:function(){return this.scenes},startScene:function(a){this.activeScene=a},endScene:function(){this.scenes.splice(this.scenes.indexOf(this.activeScene),1),this.activeScene=void 0},createBehavior:function(a,b,c){var d=Jasper.Behavior._createBehavior(b,c);return Jasper._behaviorManager._createBehavior(a,d)},setFps:function(a){fps=a}},Jasper.Layer=function(){this._scene=null,this._layerNumber=-1,this.worldSize={},this.viewportSize={},this.objects=[],this.numObjects=0,this.onInit=function(){},this.onUpdate=function(){},this.onDestroy=function(){}},Jasper.Layer.prototype={_update:function(a){this.onUpdate();for(var b=0;b<this.numObjects;b++)this.objects[b]._update(a)},_render:function(a){for(var b=0;b<this.numObjects;b++)this.objects[b]._render(a)},setWorldSize:function(a,b){this.worldSize.x=a,this.worldSize.y=b},getWorldSize:function(){return this.worldSize},setViewportSize:function(a,b){this.viewportSize.x=a,this.viewportSize.y=b},getViewportSize:function(){return this.viewportSize},addObject:function(a){a instanceof Jasper.Object?(a._layer=this,this.objects.push(a),this.numObjects++):console.log("Cannot add object of type : "+a.class+" ; needs JasperObject")},removeObject:function(){},getObjects:function(){return this.objects},getScene:function(){return this._scene}},Jasper.Object=function(a){this._id=Jasper.Object.ID++,this._layer=null,this._behaviors={},this._extraBehaviors={},this._rendererBehavior=null,this.visible=!1,this.posX=0,this.posY=0,this.worldX=0,this.worldY=0,this.rotation=0,this.alpha=0,this._name=a,this._scene=null},Jasper.Object.prototype={_update:function(a){for(var b in this._behaviors)this._behaviors[b].update(a)},_render:function(a){this._rendererBehavior instanceof Jasper.RenderableBehavior&&(this._rendererBehavior.renderBefore(a),this._rendererBehavior.render(a),this._rendererBehavior.renderAfter(a))},getPosX:function(){return this.posX},setPosX:function(a){this.posX=a},getPosY:function(){return this.posY},setPosY:function(a){this.posY=a},setPos:function(a,b){this.posX=a,this.posY=b},getAlpha:function(){return this.alpha},setAlpha:function(a){this.alpha=a},addBehavior:function(a){if("string"==typeof a){var b=Jasper._behaviorManager._addBehaviorToObject(a,this);if(b instanceof Jasper.Behavior)return b._parent=this,Jasper._behaviorManager._isNonUpdateBehavior(a)?(console.log("extra behavior found:"+a),this._extraBehaviors[a]=b):(this._behaviors[a]=b,b instanceof Jasper.RenderableBehavior&&(console.log("renderer found"),this._rendererBehavior=b)),b}},removeBehavior:function(a){Jasper._behaviorManager._deleteBehaviorFromObject(a,this),delete this._behaviors[a]},hasBehavior:function(a){return inNormalBehaviors=this._hasNormalBehavior(a),inExtraBehaviors=this._hasExtraBehavior(a),inNormalBehaviors||inExtraBehaviors},_hasNormalBehavior:function(a){return inNormalBehaviors=void 0!==this._behaviors[a]},_hasExtraBehavior:function(a){return inExtraBehaviors=void 0!==this._extraBehaviors[a]},getBehavior:function(a){return this._hasNormalBehavior(a)?this._behaviors[a]:this._hasExtraBehavior(a)?this._extraBehaviors[a]:void 0},setVisible:function(a){this.visible=a},isVisible:function(){return this.visible},setObjectRenderer:function(a){if(!(this._behaviors[a]instanceof Jasper.RendererBehavior))throw Error("Cannot add behavior "+a+" as objectRenderer. Not a RenderableBehavior");this._rendererBehavior=this._behaviors[a]},_getExtraBehaviors:function(){return this._extraBehaviors},_getAllBehaviors:function(){return this._behaviors}},Jasper.Object.ID=0,Jasper.Scene=function(a){this.sceneName=a,this.layerList=[],this.numLayers=0,this.onInit=function(){},this.onUpdate=function(){},this.onDestroy=function(){}},Jasper.Scene.prototype={_update:function(a){for(var b=0;b<this.numLayers;b++)this.onUpdate(),this.layerList[b]._update(a)},_render:function(a){for(var b=0;b<this.numLayers;b++)this.layerList[b]._render(a)},setSceneName:function(a){this.sceneName=a},getSceneName:function(){return this.sceneName},addLayer:function(a){a instanceof Jasper.Layer?(this.layerList.push(a),a.scene=this,a.layerNumber=this.numLayers,this.numLayers++):console.log("Cannot add object to scene. need Jasper.Layer")}},Jasper.Mouse=function(){this._events=[],this._callbackObjects=[],this._mousePos=[]},Jasper.Mouse.prototype={_existsCallbackObject:function(a){for(var b=this._callbackObjects.length,c=0;b>c;c++)if(a==this._callbackObjects[c])return c;return-1},getMousePos:function(){return this._mousePos},setMousePos:function(a,b){this._mousePos=[a,b]},mouseMove:function(a){this.setMousePos(a.offsetX,a.offsetY),this._events.push(["onMove",a.offsetX,a.offsetY])},mouseClick:function(a){console.log("inside mouseClick"),this._events.push(["onClick",a.offsetX,a.offsetY])},mouseDblClick:function(a){console.log("inside mouseDblClick"),this._events.push(["onDblClick",a.offsetX,a.offsetY])},mouseUp:function(a){console.log("inside mouseUp"),this._events.push(["onUp",a.offsetX,a.offsetY])},mouseDown:function(a){console.log("inside mouseDown"),this._events.push(["onDown",a.offsetX,a.offsetY])},registerCallbackObject:function(a){-1==this._existsCallbackObject(a)&&this._callbackObjects.push(a)},removeCallbackObject:function(a){var b=this._existsCallbackObject(a);-1!=b&&this._callbackObjects.splice(b,1)},_activateCallbacks:function(){for(var a=this._callbackObjects.length,b=this._events.length,c=0;b>c;c++)for(var d=this._events[c][0],e=this._events[c][1],f=this._events[c][2],g=0;a>g;g++)this._callbackObjects[g].getBehavior("mouse")[d](e,f);this._events.length=0}},Jasper.CircleDrawBehavior=function(){this.rad=0,this.strokeColor="black",this.strokeWidth=5,this.fillColor="black",this.fill=!0,this.stroke=!0},Jasper.CircleDrawBehavior.prototype=new Jasper.RenderableBehavior,Object.extend(Jasper.CircleDrawBehavior.prototype,{init:function(){},update:function(){},render:function(a){parent=this.getParentObject(),a.beginPath(),a.arc(Math.floor(parent.getPosX()),Math.floor(parent.getPosY()),this.rad,0,2*Math.PI,!0),this.fill&&(a.fillStyle=this.fillColor,a.fill()),this.stroke&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.stroke())},setRadius:function(a){return this.rad=a,this},setFillColor:function(a,b,c,d){return"string"==typeof a&&void 0===b&&void 0===c&&void 0===d?this.fillColor=a:void 0!==typeof a&&void 0!==b&&void 0!==c&&void 0===d?this.fillColor="rgba("+a+","+b+","+c+","+this.getParentObject().getAlpha()+")":void 0!==typeof a&&void 0!==b&&void 0!==c&&void 0!==d&&(this.getParentObject().setAlpha(d),this.fillColor="rgba("+a+","+b+","+c+","+d+")"),this},setFillEnabled:function(a){return this.fill=a,this},setStrokeEnabled:function(a){return this.stroke=a,this},setStrokeWidth:function(a){return this.strokeWidth=a,this}}),Jasper.MouseBehavior=function(){},Jasper.MouseBehavior.prototype=new Jasper.Behavior,Object.extend(Jasper.MouseBehavior.prototype,{init:function(a){Jasper._behaviorManager._addNonUpdateBehavior("mouse"),Jasper._mouseManager.registerCallbackObject(a)},onClick:function(){},onMove:function(){},onDown:function(){},onUp:function(){},onDblClick:function(){}}),Jasper.RandomMoveBehavior=function(){this.finalx=Math.floor(500*Math.random()+1),this.finaly=Math.floor(500*Math.random()+1),this.initx=0,this.inity=0,this.elapsed=0},Jasper.RandomMoveBehavior.prototype=new Jasper.Behavior,Object.extend(Jasper.RandomMoveBehavior.prototype,{update:function(a){parent=this.getParentObject(),this.elapsed+=a,this.elapsed<2e4&&(parent.setPosX(Math.floor((this.finalx-this.initx)/2e4*this.elapsed)),parent.setPosY(Math.floor((this.finaly-this.inity)/2e4*this.elapsed)))}}),Jasper.RectangleDrawBehavior=function(){this.width=0,this.height=0,this.strokeColor="black",this.strokeWidth=5,this.fillColor="black",this.fill=!0,this.stroke=!0},Jasper.RectangleDrawBehavior.prototype=new Jasper.RenderableBehavior,Object.extend(Jasper.RectangleDrawBehavior.prototype,{init:function(){},update:function(){},render:function(a){parent=this.getParentObject(),this.fill&&(a.fillStyle=this.fillColor,a.fillRect(parent.posX,parent.posY,this.width,this.height)),this.stroke&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.strokeRect(parent.posX,parent.posY,this.width,this.height))},setWidth:function(a){return this.width=a,this},setHeight:function(a){return this.height=a,this},setFillColor:function(a,b,c,d){return"string"==typeof a&&void 0===b&&void 0===c&&void 0===d?this.fillColor=a:void 0!==typeof a&&void 0!==b&&void 0!==c&&void 0===d?this.fillColor="rgba("+a+","+b+","+c+","+this.getParentObject().getAlpha()+")":void 0!==typeof a&&void 0!==b&&void 0!==c&&void 0!==d&&(this.getParentObject().setAlpha(d),this.fillColor="rgba("+a+","+b+","+c+","+d+")"),this},setFillEnabled:function(a){return this.fill=a,this},setStrokeEnabled:function(a){return this.stroke=a,this},setStrokeWidth:function(a){return this.strokeWidth=a,this}});