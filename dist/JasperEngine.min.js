/*! JasperEngine 23-06-2013 */
function hasOwnProperty(a,b){var c=a.__proto__||a.constructor.prototype;return b in a&&(!(b in c)||c[b]!==a[b])}var Jasper=function(){};if(Jasper.Constants={ANIM_SHORT_DURATION:1e3,ANIM_LONG_DURATION:3e3},Object.prototype.hasOwnProperty)var hasOwnProperty=function(a,b){return a.hasOwnProperty(b)};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),Object.extend=function(a,b){for(var c in b)a[c]=b[c];return a},Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Jasper.Animation=function(){this._name="",this._started=!1,this._paused=!0,this._elapsedTime=0,this._object=null,this.interpolator="linear",this._interpolator=null,this.duration=Jasper.Constants.ANIM_SHORT_DURATION,this.onStart=function(){},this.onFrame=function(){},this.onPause=function(){},this.onResume=function(){},this.onEnd=function(){}},Jasper.Animation.prototype={_setParentObject:function(a){this._object=a},getParentObject:function(){return this._object},getAnimName:function(){return this._name},_setInterpolator:function(a){if(!(a instanceof Jasper.Interpolator))throw Error("Not a valid interpolator");this._interpolator=a},setOnStart:function(a){this.onStart=a},setOnFrame:function(a){this.onFrame=a},setOnPause:function(a){this.onPause=a},setOnResume:function(a){this.onResume=a},setOnEnd:function(a){this.onEnd=a},_onStart:function(){this._started=!0,this._paused=!1,this.onStart()},_onPause:function(){this._paused=!0,this.onPause()},_onResume:function(){this._paused=!1,this.onResume()},_onEnd:function(){this.started=!1,this.getParentObject().removeAnimation(this.getAnimName()),this.onEnd()},_onFrame:function(a){this.onFrame(a)},_update:function(a){this._onFrame(a)},start:function(){this._started=!0,this._paused=!1,this._onStart()},reset:function(){this._started=!1,this._paused=!0,this._elapsedTime=0}},Jasper.Behavior=function(){this._parent=null},Jasper.Behavior.prototype.init=function(){},Jasper.Behavior.prototype.update=function(){},Jasper.Behavior.prototype.getParentObject=function(){return this._parent},Jasper.Behavior._createBehavior=function(a,b){var c=new Jasper.Behavior;Object.extend(c,b);var d=function(){};return d.prototype=c,Object.extend(d.prototype,b),d},Jasper.RenderableBehavior=function(){},Jasper.RenderableBehavior.prototype=new Jasper.Behavior,Jasper.RenderableBehavior.prototype.renderBefore=function(a){a.save()},Jasper.RenderableBehavior.prototype.renderAfter=function(a){a.restore()},Jasper.RenderableBehavior.prototype.render=function(){},Jasper.RenderableBehavior._createRenderBehavior=function(a,b){var c=new Jasper.RenderableBehavior;Object.extend(c,b);var d=function(){};return d.prototype=c,Object.extend(d.prototype,b),d},Jasper.BehaviorManager=function(){this._beh_BehObjPairs={},this._name_beh={circle:Jasper.CircleDrawBehavior,rect:Jasper.RectangleDrawBehavior,testmove:Jasper.RandomMoveBehavior,mouse:Jasper.MouseBehavior,sprite:Jasper.SpriteBehavior,collision:Jasper.CollisionBehavior},this._nonUpdateBehaviors=["mouse","collision"]},Jasper.BehaviorManager.prototype={_addBehaviorToObject:function(a,b){if("string"==typeof a){if(hasOwnProperty(this._name_beh,a)){var c=new this._name_beh[a];return void 0===this._beh_BehObjPairs[a]&&(this._beh_BehObjPairs[a]=[]),this._beh_BehObjPairs[a].push([c,b]),console.log("returning behavior",c),"undefined"==typeof c.init&&(c.prototype.init=function(){}),c}return console.log("Behavior "+a+" has not been registered to JasperCore"),console.log("returning null"),null}},_createBehavior:function(a,b){return"string"==typeof a?hasOwnProperty(this._name_beh,a)?(console.log("Behavior name already present : "+a),null):(this._name_beh[a]=b,a):void 0},_deleteBehaviorFromObject:function(a,b){if(void 0!==this._beh_BehObjPairs[a])for(var c=this._beh_BehObjPairs[a].length,d=0;c>d;d++)if(this._beh_BehObjPairs[a][d][1].__obj_id==b.__obj_id)return this._beh_BehObjPairs[a].splice(d,1),void 0},_isNonUpdateBehavior:function(a){for(var b=this._nonUpdateBehaviors.length,c=0;b>c;c++)if(this._nonUpdateBehaviors[c]==a)return!0;return!1},_addNonUpdateBehavior:function(a){this._isNonUpdateBehavior(a)||this._nonUpdateBehaviors.push(a)},_getAllBehaviors:function(){var a=[];for(var b in this._name_beh)a.push(b);return a},_getBehArray:function(){return this._beh_BehObjPairs}},Jasper.Camera=function(a){this.posX=0,this.posY=0,this.width=a.width,this.height=a.height,this.worldWidth=a.worldWidth,this.worldHeight=a.worldHeight},Jasper.Camera.prototype={setCameraX:function(a){return a+this.width<=this.worldWidth&&a>=0&&(this.posX=Math.floor(a)),this},setCameraY:function(a){return a>=0&&a+this.height<=this.worldHeight&&(this.posY=Math.floor(a)),this},setCameraPos:function(a,b){a+this.width<=this.worldWidth&&a>=0&&(this.posX=Math.floor(a)),b>=0&&b+this.height<=this.worldHeight&&(this.posY=Math.floor(b))},getCameraX:function(){return this.posX},getCameraY:function(){return this.posY},followObject:function(){},getViewportPos:function(a){return[a.getPosX()-this.getCameraX(),a.getPosY()-this.getCameraY()]}},Jasper.CollisionManager=function(){this._layerNumber_Objects={},this._layerNum_QuadTree={},this._layerNumber_TreeObjects={},this._waitingList=[],this.count=0},Jasper.CollisionManager.prototype={_registerCollidableObject:function(a){try{if(void 0===a.getLayer())return this._waitingList.push(a),void 0}catch(b){console.log(a)}void 0===this._layerNum_QuadTree[a.getLayer().getLayerNumber()]&&(args={x:0,y:0,w:500,h:500},this._layerNum_QuadTree[a.getLayer().getLayerNumber()]=QUAD.init(args)),void 0===this._layerNumber_Objects[a.getLayer().getLayerNumber()]&&(this._layerNumber_Objects[a.getLayer().getLayerNumber()]=[],this._layerNumber_TreeObjects[a.getLayer().getLayerNumber()]=[]),this._hasAlreadyRegistered(a)===!1&&this._layerNumber_Objects[a.getLayer().getLayerNumber()].push(a)},_clearWaiting:function(a){len=this._waitingList.length;for(var b=0;len>b;b++)if(a===this._waitingList[b]){this._registerCollidableObject(a),this._waitingList.splice(b,1);break}},_hasAlreadyRegistered:function(a){objs=this._layerNumber_Objects[a.getLayer().getLayerNumber()],len=objs.length,registered=!1;for(var b=0;len>b;b++)a==objs[b]&&(registered=!0);return registered},calculateCollisions:function(){this.count=0;for(var a in this._layerNum_QuadTree){tree=this._layerNum_QuadTree[a],tree.clear();for(var b=this._layerNumber_Objects[a].length,c=0;b>c;c++){var d=this._layerNumber_Objects[a][c],e={x:Math.floor(d.posX),y:Math.floor(d.posY),h:d.height,w:d.width,obj:d};tree.insert(e),this._layerNumber_TreeObjects[a].push(e)}this._activateCollisionsInLayer(a)}},_activateCollisionsInLayer:function(a){for(var b=this._layerNumber_Objects[a].length,c=this._layerNum_QuadTree[a],d=0;b>d;d++){this._layerNumber_Objects[a][d];var e=this._layerNumber_TreeObjects[a][d];c.retrieve(e,function(a){e!=a&&e.x<a.x+a.w&&e.x+e.w>a.x&&e.y<a.y+a.h&&e.y+e.h>a.y&&(e.obj.getBehavior("collision").onCollide(a.obj),a.obj.getBehavior("collision").onCollide(e.obj))})}this._layerNumber_TreeObjects[a].length=0}},Jasper.Core=function(a){this.fps=60,this.running=!1,this.lastTime=0,this.canvas=null,this.canvasWidth=a.canvasWidth,this.canvasHeight=a.canvasHeight,this.containerId=a.container,this.canvasContext=null,this.scenes=[],this.activeScene=null,this.__next_objid=1,this.onInit=function(){}},Jasper.Core.prototype={_createCanvas:function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.canvas.onmousemove=function(a){Jasper._mouseManager.mouseMove(a)},this.canvas.onmousedown=Jasper._mouseManager.mouseDown.bind(Jasper._mouseManager),this.canvas.onmouseup=Jasper._mouseManager.mouseUp.bind(Jasper._mouseManager),this.canvas.onclick=Jasper._mouseManager.mouseClick.bind(Jasper._mouseManager),this.canvas.ondblclick=Jasper._mouseManager.mouseDblClick.bind(Jasper._mouseManager),this.canvasContext=this.canvas.getContext("2d"),document.getElementById(this.containerId).appendChild(this.canvas)},_render:function(){this.canvasContext.save(),this.canvasContext.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.activeScene._render(this.canvasContext),this.canvasContext.restore()},_update:function(){requestAnimFrame(this._update.bind(this)),currTime=(new Date).getTime(),dt=currTime-this.lastTime,this.lastTime=currTime,this.running&&(this.activeScene._update(dt),Jasper._mouseManager._activateCallbacks(),Jasper._collisionManager.calculateCollisions(),Jasper._animationManager._runAnimations(dt),this._render())},_start:function(){this.onInit(),this.lastTime=(new Date).getTime(),this.running=!0,requestAnimFrame(this._update.bind(this))},_getBehaviorManager:function(){return Jasper._behaviorManager},init:function(){return Jasper._core=this,Jasper._mouseManager=new Jasper.Mouse,Jasper._behaviorManager=new Jasper.BehaviorManager,Jasper._spriteManager=new Jasper.SpriteManager,Jasper._collisionManager=new Jasper.CollisionManager,Jasper._animationManager=new Jasper.AnimationManager,this._createCanvas(),this._start(),this},pause:function(){return this.running=!1,this},play:function(){return this.running=!0,this},getCanvas:function(){return this.canvas},getMouseManager:function(){return Jasper._mouseManager},addScene:function(a){if(!(a instanceof Jasper.Scene))throw Error("Can only add a valid Jasper.Scene");return-1==this.scenes.indexOf(a)?(this.scenes.push(a),a._onAdd(),this):void 0},removeScene:function(a){if(this.activeScene==a)throw Error("Trying to remove currently active scene not permitted. end scene first");var b=this.scenes.indexOf(a);return-1!=b?(this.scenes[b]._onDestroy(),this.scenes.splice(b,1),this):void 0},removeSceneByName:function(a){if(this.activeScene.getSceneName()==a)throw Error("Trying to remove currently active scene not permitted.");for(var b=0;b<this.scenes.length;b++)if(this.scenes[b].getSceneName()==a)return this.scenes.splice(b,1),this},getCurrentScene:function(){return this.activeScene},startScene:function(a){if(a instanceof Jasper.Scene)return a._onStart(),this.activeScene=a,this;throw Error("Can only start a valid Jasper.Scene")},endScene:function(){return this.scenes.splice(this.scenes.indexOf(this.activeScene),1),this.activeScene=void 0,this},getSceneByName:function(a){for(var b=0;b<this.scenes.length;b++)if(this.scenes[b].getSceneName()==a)return this.scenes[b]},getScenes:function(){return this.scenes},createBehavior:function(a,b,c){var d=Jasper.Behavior._createBehavior(b,c);return Jasper._behaviorManager._createBehavior(a,d)}},Jasper.Interpolator=function(){},Jasper.Interpolator.prototype={getValue:function(){}},Jasper.Layer=function(a){this._name=a.name,this._hud=!1,this._camera=void 0,void 0!==a.hud&&(this._hud=!0),this._scene=null,this._layerNumber=-1,this.worldW=0,this.worldH=0,this.objects=[],this.numObjects=0,this.onAdd=function(){},this.onObjectAdd=function(){},this.onObjectRemove=function(){},this.onUpdate=function(){},this.onDestroy=function(){}},Jasper.Layer.prototype={_update:function(a){this.onUpdate();for(var b=0;b<this.numObjects;b++)this.objects[b]._update(a)},_render:function(a){for(var b=0;b<this.numObjects;b++)this.objects[b]._render(a)},_onAdd:function(){this.onAdd()},_onStart:function(){this.onStart()},_onDestroy:function(){this.onDestroy();for(var a=objects.length,b=0;a>b;b++)objects[b]._onDestroy()},_onObjectAdd:function(a){this.onObjectAdd(a)},_onObjectRemove:function(a){this.onObjectRemove(a)},getWorldSize:function(){return[this.worldW,this.worldH]},addObject:function(a){if(a instanceof Jasper.Object)return a._layer=this,this.objects.push(a),this.numObjects++,this._onObjectAdd(a),a._onAddedToLayer(),this;throw Error("Cannot add object, needs JasperObject")},removeObject:function(a){if(a instanceof Jasper.Object){var b=this.objects.indexOf(a);return-1!==b&&(obj=this.objects.splice(b,1),this._onObjectRemove(obj)),this}throw Error("Cannot remove object, needs JasperObject")},getObjects:function(){return this.objects},getScene:function(){return this._scene},getLayerNumber:function(){return this._layerNumber},getCamera:function(){return this._camera},isHud:function(){return this._hud}},Jasper.Object=function(a){this._id=Jasper.Object.ID++,this._layer=void 0,this._initWaiting=[],this._behaviors={},this._extraBehaviors={},this._rendererBehavior=null,this._anims={},this.visible=!1,this.posX=0,this.posY=0,this.height=0,this.width=0,this._viewportX=0,this._viewportY=0,this.rotation=0,this.alpha=0,this._name=a,this._scene=null},Jasper.Object.prototype={_update:function(a){if(this._initWaiting.length>0)for(var b=this._initWaiting.pop();void 0!==b;)b.init(),b=this._initWaiting.pop();for(var c in this._behaviors)this._behaviors[c].update(a)},_render:function(a){this._rendererBehavior instanceof Jasper.RenderableBehavior&&(this._rendererBehavior.renderBefore(a),this._rendererBehavior.render(a),this._rendererBehavior.renderAfter(a))},_runAnimations:function(a){for(var b in this._anims)this._anims[b]._update(a);this._checkAnimationList()},_checkAnimationList:function(){var a=!1;for(var b in this._anims)if(hasOwnProperty.call(this._anims,b)){a=!1;break}a&&Jasper._animationManager._unregisterObject(this)},removeAnimation:function(a){delete this._anims[a],this._checkAnimationList()},addAnimation:function(a,b){var c=Jasper._animationManager._createAnimation(a,b);return this._anims[a]=c,c._setParentObject(this),Jasper._animationManager._registerObject(this),c},_onAddedToLayer:function(){Jasper._collisionManager._clearWaiting(this)},getPosX:function(){return this.posX},setPosX:function(a){this.posX=Math.floor(a)},getPosY:function(){return this.posY},setPosY:function(a){this.posY=Math.floor(a)},getViewportPos:function(){return this.getLayer().isHud()?[this.getPosX(),this.getPosY()]:this.getLayer().getCamera().getViewportPos(this)},setPos:function(a,b){this.posX=Math.floor(a),this.posY=Math.floor(b)},getAlpha:function(){return this.alpha},setAlpha:function(a){this.alpha=a},getRotationAngle:function(){return 180*this.rotation/Math.PI},setRotationAngle:function(a){this.rotation=a*Math.PI/180},getRotationRadian:function(){return this.rotation},setRotationARadian:function(a){this.rotation=a},getLayer:function(){return this._layer},_addInitWaiting:function(a){this._initWaiting.push(a)},addBehavior:function(a){if("string"==typeof a){var b=Jasper._behaviorManager._addBehaviorToObject(a,this);if(b instanceof Jasper.Behavior)return b._parent=this,this._addInitWaiting(b),Jasper._behaviorManager._isNonUpdateBehavior(a)?(console.log("extra behavior found:"+a),this._extraBehaviors[a]=b):(this._behaviors[a]=b,b instanceof Jasper.RenderableBehavior&&(console.log("renderer found"),this._rendererBehavior=b)),b}},removeBehavior:function(a){Jasper._behaviorManager._deleteBehaviorFromObject(a,this),delete this._behaviors[a]},hasBehavior:function(a){return inNormalBehaviors=this._hasNormalBehavior(a),inExtraBehaviors=this._hasExtraBehavior(a),inNormalBehaviors||inExtraBehaviors},_hasNormalBehavior:function(a){return inNormalBehaviors=void 0!==this._behaviors[a]},_hasExtraBehavior:function(a){return inExtraBehaviors=void 0!==this._extraBehaviors[a]},getBehavior:function(a){return this._hasNormalBehavior(a)?this._behaviors[a]:this._hasExtraBehavior(a)?this._extraBehaviors[a]:void 0},setVisible:function(a){this.visible=a},isVisible:function(){return this.visible},setObjectRenderer:function(a){if(!(this._behaviors[a]instanceof Jasper.RendererBehavior))throw Error("Cannot add behavior "+a+" as objectRenderer. Not a RenderableBehavior");this._rendererBehavior=this._behaviors[a]},_getExtraBehaviors:function(){return this._extraBehaviors},_getAllBehaviors:function(){return this._behaviors}},Jasper.Object.ID=0,Jasper.Scene=function(a){this.sceneName=a.name,this.worldW=a.worldW,this.worldH=a.worldH,this._camera=new Jasper.Camera({width:500,height:500,worldWidth:this.worldW,worldHeight:this.worldH}),this.layerList=[],this.numLayers=0,this.onAdd=function(){},this.onAddLayer=function(){},this.onStart=function(){},this.onUpdate=function(){},this.onDestroy=function(){}},Jasper.Scene.prototype={_update:function(a){for(var b=0;b<this.numLayers;b++)this.onUpdate(),this.layerList[b]._update(a)},_render:function(a){for(var b=0;b<this.numLayers;b++)this.layerList[b]._render(a)},_onAdd:function(){this.onAdd()},_onStart:function(){this.onStart()},_onDestroy:function(){this.onDestroy();for(var a=this.layerList.length,b=0;a>b;b++)this.layerList[b]._onDestroy()},_onAddLayer:function(a){this.onAddLayer(a)},setSceneName:function(a){return this.sceneName=a,this},getSceneName:function(){return this.sceneName},addLayer:function(a){if(a instanceof Jasper.Layer)return a.worldW=this.worldW,a.worldH=this.worldH,this.layerList.push(a),a.scene=this,a._layerNumber=this.numLayers,a._camera=this._camera,this.numLayers++,this._onAddLayer(a),a._onAdd(),this;throw Error("Cannot add object to scene. need Jasper.Layer")},addLayers:function(a){for(var b=a.length,c=0;b>c;c++)this.addLayer(a[c])},getLayerWithNumber:function(a){len=this.layerList.length;for(var b=0;len>b;b++)if(this.layerList[b].getLayerNumber()==a)return this.layerList[b];return null},getLayers:function(){return this.layerList}},Jasper.SpriteManager=function(){this._loadingCache={},this._spriteCache={},this._waitingBehaviors={},this._spriteNativeSizes={},this._spriteRegionRect={}},Jasper.SpriteManager.prototype={setSprite:function(a,b){if(void 0!==this._spriteCache[b])a._sprite=this._spriteCache[b],a._nativeWidth=this._spriteCache[b].width,a._nativeHeight=this._spriteCache[b].height,a._adjustDimensions(),a._loaded=!0;else if(void 0!==this._loadingCache[b])this._addToWaitingList(a,b);else{var c=new Image;c.spritePath=b,this._loadingCache[b]=c,this._addToWaitingList(a,b),c.onload=function(){var a=Jasper._spriteManager;a._spriteCache[c.spritePath]=this,delete a._loadingCache[c.spritePath],a._clearWaitingBehaviors(c.spritePath)},c.src=b}},_clearWaitingBehaviors:function(a){if(void 0!==this._waitingBehaviors[a]){for(var b=this._waitingBehaviors[a].pop();void 0!==b;)b._sprite=this._spriteCache[a],b._nativeWidth=this._spriteCache[a].width,b._nativeHeight=this._spriteCache[a].height,b._adjustDimensions(),b._loaded=!0,b=this._waitingBehaviors[a].pop();delete this._waitingBehaviors[a]}},_addToWaitingList:function(a,b){void 0===this._waitingBehaviors[b]&&(this._waitingBehaviors[b]=[]),this._waitingBehaviors[b].push(a)}},Jasper.AnimationManager=function(){this._objectsToAnimate=[],this._animLookup={move:Jasper.MoveAnimation,movex:Jasper.MoveXAnimation,movey:Jasper.MoveYAnimation,alpha:Jasper.AlphaAnimation,rotate:Jasper.RotateAnimation},this._interpolatorLookup={linear:Jasper.LinearInterpolator,swing:Jasper.SwingInterpolator}},Jasper.AnimationManager.prototype={_runAnimations:function(a){for(var b=this._objectsToAnimate.length,c=0;b>c;c++)this._objectsToAnimate[c]._runAnimations(a)},_registerObject:function(a){var b=this._objectsToAnimate.indexOf(a);-1===b&&this._objectsToAnimate.push(a)},_unregisterObject:function(a){var b=this._objectsToAnimate.indexOf(a);-1!==b&&this._objectsToAnimate.splice(b,1)},_createAnimation:function(a,b){var c=new this._animLookup[a];return void 0===c?null:(Object.extend(c,b),c._setInterpolator(new this._interpolatorLookup[c.interpolator]),c)}},Jasper.Mouse=function(){this._events=[],this._onClickObjects=[],this._onMoveObjects=[],this._onDownObjects=[],this._onUpObjects=[],this._onDblClickObjects=[],this._callbackObjects=[],this._mousePos=[]},Jasper.Mouse.prototype={_existsCallbackObject:function(a){for(var b=this._callbackObjects.length,c=0;b>c;c++)if(a==this._callbackObjects[c])return c;return-1},getMousePos:function(){return this._mousePos},setMousePos:function(a,b){this._mousePos=[a,b]},mouseMove:function(a){this.setMousePos(a.offsetX,a.offsetY),this._events.push(["onMove",a.offsetX,a.offsetY])},mouseClick:function(a){console.log("inside mouseClick"),this._events.push(["onClick",a.offsetX,a.offsetY])},mouseDblClick:function(a){console.log("inside mouseDblClick"),this._events.push(["onDblClick",a.offsetX,a.offsetY])},mouseUp:function(a){console.log("inside mouseUp"),this._events.push(["onUp",a.offsetX,a.offsetY])},mouseDown:function(a){console.log("inside mouseDown"),this._events.push(["onDown",a.offsetX,a.offsetY])},registerOnClickObject:function(a){a instanceof Jasper.Object&&this._onClickObjects.push(a)},registerOnMoveObject:function(a){a instanceof Jasper.Object&&this._onMoveObjects.push(a)},registerOnDownObject:function(a){a instanceof Jasper.Object&&this._onDownObjects.push(a)},registerOnUpObject:function(a){a instanceof Jasper.Object&&this._onUpObjects.push(a)},registerOnDblClickObject:function(a){a instanceof Jasper.Object&&this._onDblClickObjects.push(a)},unregisterOnClickObject:function(a){if(a instanceof Jasper.Object)for(var b=this._onClickObjects.length,c=0;b>c;c++)if(this._onClickObjects[c]==object){this._onClickObjects.splice(c,1);break}},unregisterOnMoveObject:function(a){if(a instanceof Jasper.Object)for(var b=this._onMoveObjects.length,c=0;b>c;c++)if(this._onClickObjects[c]==object){this._onMoveObjects.splice(c,1);break}},unregisterOnDownObject:function(a){if(a instanceof Jasper.Object)for(var b=this._onDownObjects.length,c=0;b>c;c++)if(this._onClickObjects[c]==object){this._onDownObjects.splice(c,1);break}},unregisterOnUpObject:function(a){if(a instanceof Jasper.Object)for(var b=this._onUpObjects.length,c=0;b>c;c++)if(this._onClickObjects[c]==object){this._onUpObjects.splice(c,1);break}},unregisterOnDblClickObject:function(a){if(a instanceof Jasper.Object)for(var b=this._onDblClickObjects.length,c=0;b>c;c++)if(this._onClickObjects[c]==object){this._onDblClickObjects.splice(c,1);break}},registerCallbackObject:function(a){-1==this._existsCallbackObject(a)&&this._callbackObjects.push(a)},removeCallbackObject:function(a){var b=this._existsCallbackObject(a);-1!=b&&this._callbackObjects.splice(b,1)},_activateCallbacks:function(){for(var a=0,b=this._events.length,c=0;b>c;c++){var d=this._events[c][0],e=this._events[c][1],f=this._events[c][2],g=this["_"+d+"Objects"];a=g.length;for(var h=0;a>h;h++)g[h].getBehavior("mouse")[d](e,f)}this._events.length=0}};var QUAD={};QUAD.init=function(a){var b,c=0,d=1,e=2,f=3,g=4;return a.maxChildren=a.maxChildren||2,a.maxDepth=a.maxDepth||4,b=function(a,h,i,j,k,l,m){var n=[],o=[];return{x:a,y:h,w:i,h:j,depth:k,retrieve:function(a,b){for(var c=0;c<n.length;++c)b(n[c]);o.length&&this.findOverlappingNodes(a,function(c){o[c].retrieve(a,b)})},insert:function(a){var b;o.length?(b=this.findInsertNode(a),b===g?n.push(a):o[b].insert(a)):(n.push(a),n.length>l&&this.depth<m&&this.divide())},findInsertNode:function(b){return b.x+b.w<a+i/2?b.y+b.h<h+j/2?c:b.y>=h+j/2?e:g:b.x>=a+i/2?b.y+b.h<h+j/2?d:b.y>=h+j/2?f:g:g},findOverlappingNodes:function(b,g){b.x<a+i/2&&(b.y<h+j/2&&g(c),b.y+b.h>=h+j/2&&g(e)),b.x+b.w>=a+i/2&&(b.y<h+j/2&&g(d),b.y+b.h>=h+j/2&&g(f))},divide:function(){var a,c,d,e,f=this.depth+1;for(a=i/2,c=j/2,o.push(b(this.x,this.y,a,c,f,l,m)),o.push(b(this.x+a,this.y,a,c,f,l,m)),o.push(b(this.x,this.y+c,a,c,f,l,m)),o.push(b(this.x+a,this.y+c,a,c,f,l,m)),e=n,n=[],d=0;d<e.length;d++)this.insert(e[d])},clear:function(){for(var a=0;a<o.length;a++)o[a].clear();n.length=0,o.length=0},getNodes:function(){return o.length?o:!1}}},{root:function(){return b(a.x,a.y,a.w,a.h,0,a.maxChildren,a.maxDepth)}(),insert:function(a){var b,c;if(a instanceof Array)for(b=a.length,c=0;b>c;c++)this.root.insert(a[c]);else this.root.insert(a)},retrieve:function(a,b){return this.root.retrieve(a,b)},clear:function(){this.root.clear()}}},Jasper.CircleDrawBehavior=function(){this.rad=0,this.strokeColor="black",this.strokeWidth=5,this.fillColor="black",this.fill=!0,this.stroke=!0},Jasper.CircleDrawBehavior.prototype=new Jasper.RenderableBehavior,Object.extend(Jasper.CircleDrawBehavior.prototype,{init:function(){},update:function(){},render:function(a){parent=this.getParentObject(),a.beginPath(),a.arc(Math.floor(parent.getPosX()),Math.floor(parent.getPosY()),this.rad,0,2*Math.PI,!0),this.fill&&(a.fillStyle=this.fillColor,a.fill()),this.stroke&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.stroke())},setRadius:function(a){return this.rad=a,this},setFillColor:function(a,b,c,d){return"string"==typeof a&&void 0===b&&void 0===c&&void 0===d?this.fillColor=a:void 0!==typeof a&&void 0!==b&&void 0!==c&&void 0===d?this.fillColor="rgba("+a+","+b+","+c+","+this.getParentObject().getAlpha()+")":void 0!==typeof a&&void 0!==b&&void 0!==c&&void 0!==d&&(this.getParentObject().setAlpha(d),this.fillColor="rgba("+a+","+b+","+c+","+d+")"),this},setFillEnabled:function(a){return this.fill=a,this},setStrokeEnabled:function(a){return this.stroke=a,this},setStrokeWidth:function(a){return this.strokeWidth=a,this}}),Jasper.CollisionBehavior=function(){this._collided=!1},Jasper.CollisionBehavior.prototype=new Jasper.Behavior,Object.extend(Jasper.CollisionBehavior.prototype,{init:function(){Jasper._behaviorManager._addNonUpdateBehavior("collision"),Jasper._collisionManager._registerCollidableObject(this.getParentObject())},setOnCollide:function(a){this.onCollide=a},onCollide:function(){}}),Jasper.MouseBehavior=function(){},Jasper.MouseBehavior.prototype=new Jasper.Behavior,Object.extend(Jasper.MouseBehavior.prototype,{init:function(){Jasper._behaviorManager._addNonUpdateBehavior("mouse")},onClick:function(){},onMove:function(){},onDown:function(){},onUp:function(){},onDblClick:function(){},setOnClick:function(a){return this.onClick=a,Jasper._mouseManager.registerOnClickObject(this.getParentObject()),this},setOnMove:function(a){return this.onMove=a,Jasper._mouseManager.registerOnMoveObject(this.getParentObject()),this},setOnDown:function(a){return this.onDown=a,Jasper._mouseManager.registerOnDownObject(this.getParentObject()),this},setOnUp:function(a){return this.onUp=a,Jasper._mouseManager.registerOnUpObject(this.getParentObject()),this},setOnDblClick:function(a){return this.onDblClick=a,Jasper._mouseManager.registerOnDblClickObject(this.getParentObject()),this},removeOnClick:function(){delete this.onClick,Jasper._mouseManager.unregisterOnClickObject(this.getParentObject())},removeOnMove:function(){delete this.onMove,Jasper._mouseManager.unregisterOnMoveObject(this.getParentObject())},removeOnDown:function(){delete this.onDown,Jasper._mouseManager.unregisterOnDownObject(this.getParentObject())},removeOnUp:function(){delete this.onUp,Jasper._mouseManager.unregisterOnUpObject(this.getParentObject())},removeOnDblClick:function(){delete this.onDblClick,Jasper._mouseManager.unregisterOnDblClickObject(this.getParentObject())}}),Jasper.PolygonDrawBehavior=function(){this._points=[],this._numPoints=0,this.strokeColor="black",this.strokeWidth=5,this.fillColor="black",this.fill=!0,this.stroke=!0},Jasper.PolygonDrawBehavior.prototype=new Jasper.RenderableBehavior,Object.extend(Jasper.PolygonDrawBehavior.prototype,{init:function(){},update:function(){},render:function(a){parent=this.getParentObject(),a.beginPath(),a.moveTo(this._points[0][0],this._points[0][1]);for(var b=0;b<this._numPoints;b++)a.lineTo(this._points[this._numPoints][0],this._points[this._numPoints][1]);a.closePath(),this.fill&&(a.fillStyle=this.fillColor,a.fill()),this.stroke&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.stroke())},addPoint:function(a){return parent=this.getParentObject(),0===this._numPoints?(parent.posX=a[0],parent.posY=a[1],parent.width=0,parent.height=0):(a[0]<parent.posX&&(parent.posX=a[0]),a[1]<parent.posY&&(parent.posY=a[1]),a[0]>parent.posX+parent.width&&(parent.width=a[0]-parent.posX),a[1]>parent.posY+parent.height&&(parent.height=a[1]-parent.posY)),this._points.push(a),this._numPoints++,this},addPoints:function(a){for(var b=a.length,c=0;b>c;c++)this.addPoint(a[c])},clearPoints:function(){this._points.length=0,this._numPoints=0},setFillColor:function(a,b,c,d){return"string"==typeof a&&void 0===b&&void 0===c&&void 0===d?this.fillColor=a:void 0!==typeof a&&void 0!==b&&void 0!==c&&void 0===d?this.fillColor="rgba("+a+","+b+","+c+","+this.getParentObject().getAlpha()+")":void 0!==typeof a&&void 0!==b&&void 0!==c&&void 0!==d&&(this.getParentObject().setAlpha(d),this.fillColor="rgba("+a+","+b+","+c+","+d+")"),this},setFillEnabled:function(a){return this.fill=a,this},setStrokeEnabled:function(a){return this.stroke=a,this},setStrokeWidth:function(a){return this.strokeWidth=a,this}}),Jasper.RandomMoveBehavior=function(){this.finalx=Math.floor(500*Math.random()+1),this.finaly=Math.floor(500*Math.random()+1),this.initx=0,this.inity=0,this.elapsed=0},Jasper.RandomMoveBehavior.prototype=new Jasper.Behavior,Object.extend(Jasper.RandomMoveBehavior.prototype,{update:function(a){parent=this.getParentObject(),this.elapsed+=a,this.elapsed<2e4&&(parent.setPosX(Math.floor((this.finalx-this.initx)/2e4*this.elapsed)),parent.setPosY(Math.floor((this.finaly-this.inity)/2e4*this.elapsed)))}}),Jasper.RectangleDrawBehavior=function(){this.width=0,this.height=0,this.strokeColor="black",this.strokeWidth=5,this.fillColor="black",this.fill=!0,this.stroke=!0},Jasper.RectangleDrawBehavior.prototype=new Jasper.RenderableBehavior,Object.extend(Jasper.RectangleDrawBehavior.prototype,{init:function(){},update:function(){},render:function(a){parent=this.getParentObject(),this.fill&&(a.fillStyle=this.fillColor,a.fillRect(parent.posX,parent.posY,this.width,this.height)),this.stroke&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.strokeRect(parent.posX,parent.posY,this.width,this.height))},setWidth:function(a){return this.width=a,this},setHeight:function(a){return this.height=a,this},setFillColor:function(a,b,c,d){return"string"==typeof a&&void 0===b&&void 0===c&&void 0===d?this.fillColor=a:void 0!==typeof a&&void 0!==b&&void 0!==c&&void 0===d?this.fillColor="rgba("+a+","+b+","+c+","+this.getParentObject().getAlpha()+")":void 0!==typeof a&&void 0!==b&&void 0!==c&&void 0!==d&&(this.getParentObject().setAlpha(d),this.fillColor="rgba("+a+","+b+","+c+","+d+")"),this},setFillEnabled:function(a){return this.fill=a,this},setStrokeEnabled:function(a){return this.stroke=a,this},setStrokeWidth:function(a){return this.strokeWidth=a,this}}),Jasper.SpriteBehavior=function(){this._nativeWidth=0,this._nativeHeight=0,this._scaleX=1,this._scaleY=1,this._sprite=null,this._path="",this._loaded=!1,this._sprite=null,this._toAdjust=!1},Jasper.SpriteBehavior.prototype=new Jasper.RenderableBehavior,Object.extend(Jasper.SpriteBehavior.prototype,{init:function(){},update:function(){},render:function(a){this._loaded&&(parent=this.getParentObject(),pos=parent.getViewportPos(),a.drawImage(this._sprite,pos[0],pos[1],parent.width,parent.height))},setSprite:function(a){return this._path!=a&&(this._path=a,Jasper._spriteManager.setSprite(this,this._path)),this},setHeight:function(a){return this.getParentObject().height=Math.floor(a),this},setWidth:function(a){return this.getParentObject().width=Math.floor(a),this},getHeight:function(){return this.getParentObject().height},getWidth:function(){return this.getParentObject().width},getNativeHeight:function(){return this._nativeHeight},getNativeWidth:function(){return this._nativeWidth},setScaleX:function(a){return this._toAdjust=!0,this.getParentObject().width=Math.floor(this._nativeWidth*this._scaleX),this._scaleX=a,this},setScaleY:function(a){return this._toAdjust=!0,this.getParentObject().height=Math.floor(this._nativeHeight*this._scaleY),this._scaleY=a,this},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},_adjustDimensions:function(){this._toAdjust&&(parent=this.getParentObject(),parent.width=Math.floor(this._nativeWidth*this._scaleX),parent.height=Math.floor(this._nativeHeight*this._scaleY))
}}),Jasper.AlphaAnimation=function(){this._name="alpha",this.fromAlpha=null,this.toAlpha=null},Jasper.AlphaAnimation.prototype=new Jasper.Animation,Object.extend(Jasper.AlphaAnimation.prototype,{_update:function(a){this._started&&!this._paused&&(this._elapsedTime+=a,this._elapsedTime>=this.duration?(this.getParentObject().setAlpha(this.toAlpha),this._onFrame(a),this._onEnd(a)):(this.getParentObject().setAlpha(this._interpolator.getValue(this.fromAlpha,this.toAlpha,this._elapsedTime,this.duration)),this._onFrame(a)))}}),Jasper.LinearInterpolator=function(){},Jasper.LinearInterpolator.prototype=new Jasper.Interpolator,Object.extend(Jasper.LinearInterpolator.prototype,{getValue:function(a,b,c,d){return a+1*((b-a)*c/d)}}),Jasper.MoveAnimation=function(){this._name="move",this.fromX=null,this.fromY=null,this.toX=null,this.toY=null},Jasper.MoveAnimation.prototype=new Jasper.Animation,Object.extend(Jasper.MoveAnimation.prototype,{_update:function(a){this._started&&!this._paused&&(this._elapsedTime+=a,this._elapsedTime>=this.duration?(this.getParentObject().setPos(this.toX,this.toY),this._onFrame(a),this._onEnd(a)):(this.getParentObject().setPos(this._interpolator.getValue(this.fromX,this.toX,this._elapsedTime,this.duration),this._interpolator.getValue(this.fromY,this.toY,this._elapsedTime,this.duration)),this._onFrame(a)))}}),Jasper.MoveXAnimation=function(){this._name="movex",this.fromX=null,this.toX=null},Jasper.MoveXAnimation.prototype=new Jasper.Animation,Object.extend(Jasper.MoveXAnimation.prototype,{_update:function(a){this._started&&!this._paused&&(this._elapsedTime+=a,this._elapsedTime>=this.duration?(this.getParentObject().setPosX(this.toX),this._onFrame(a),this._onEnd(a)):(this.getParentObject().setPosX(this._interpolator.getValue(this.fromX,this.toX,this._elapsedTime,this.duration)),this._onFrame(a)))}}),Jasper.MoveYAnimation=function(){this._name="movey",this.fromY=null,this.toY=null},Jasper.MoveYAnimation.prototype=new Jasper.Animation,Object.extend(Jasper.MoveYAnimation.prototype,{_update:function(a){this._started&&!this._paused&&(this._elapsedTime+=a,this._elapsedTime>=this.duration?(this.getParentObject().setPosY(this.toY),this._onFrame(a),this._onEnd(a)):(this.getParentObject().setPosY(this._interpolator.getValue(this.fromY,this.toY,this._elapsedTime,this.duration)),this._onFrame(a)))}}),Jasper.RotateAnimation=function(){this._name="rotate",this.fromRadian=null,this.fromAngle=null,this.toRadian=null,this.toAngle=null},Jasper.RotateAnimation.prototype=new Jasper.Animation,Object.extend(Jasper.RotateAnimation.prototype,{_update:function(a){this._started&&!this._paused&&(this._elapsedTime+=a,this._elapsedTime>=this.duration?(this._setRotation(!0),this._onFrame(a),this._onEnd(a)):(this._setRotation(),this._onFrame(a)))},_setRotation:function(a){null===this.fromRadian&&null===this.toRadian?a?this.getParentObject().setRotationAngle(this.toAngle):this.getParentObject().setRotationAngle(this._interpolator.getValue(this.fromAngle,this.toAngle,this._elapsedTime,this.duration)):a?this.getParentObject().setRotation(this.toRadian):this.getParentObject().setRotation(this._interpolator.getValue(this.fromRadian,this.toRadian,this._elapsedTime,this.duration))}}),Jasper.SwingInterpolator=function(){},Jasper.SwingInterpolator.prototype=new Jasper.Interpolator,Object.extend(Jasper.SwingInterpolator.prototype,{getValue:function(a,b,c,d){return a+(b-a)*(-Math.cos(c/d*Math.PI)/2+.5)}});