/*! JasperEngine 20-06-2013 */
function hasOwnProperty(a,b){var c=a.__proto__||a.constructor.prototype;return b in a&&(!(b in c)||c[b]!==a[b])}var Jasper=function(){};if(Object.prototype.hasOwnProperty)var hasOwnProperty=function(a,b){return a.hasOwnProperty(b)};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),Object.extend=function(a,b){for(var c in b)a[c]=b[c];return a},Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Jasper.Behavior=function(){this._parent=null},Jasper.Behavior.prototype.init=function(){},Jasper.Behavior.prototype.update=function(){},Jasper.Behavior.prototype.getParentObject=function(){return this._parent},Jasper.Behavior._createBehavior=function(a,b){var c=new Jasper.Behavior;Object.extend(c,b);var d=function(){};return d.prototype=c,Object.extend(d.prototype,b),d},Jasper.RenderableBehavior=function(){},Jasper.RenderableBehavior.prototype=new Jasper.Behavior,Jasper.RenderableBehavior.prototype.renderBefore=function(a){a.save()},Jasper.RenderableBehavior.prototype.renderAfter=function(a){a.restore()},Jasper.RenderableBehavior.prototype.render=function(){},Jasper.RenderableBehavior._createRenderBehavior=function(a,b){var c=new Jasper.RenderableBehavior;Object.extend(c,b);var d=function(){};return d.prototype=c,Object.extend(d.prototype,b),d},Jasper.BehaviorManager=function(){this._beh_BehObjPairs={},this._name_beh={circle:Jasper.CircleDrawBehavior,rect:Jasper.RectangleDrawBehavior,testmove:Jasper.RandomMoveBehavior,mouse:Jasper.MouseBehavior,sprite:Jasper.SpriteBehavior,collision:Jasper.CollisionBehavior},this._nonUpdateBehaviors=["mouse","collision"]},Jasper.BehaviorManager.prototype={_addBehaviorToObject:function(a,b){if("string"==typeof a){if(hasOwnProperty(this._name_beh,a)){var c=new this._name_beh[a];return void 0===this._beh_BehObjPairs[a]&&(this._beh_BehObjPairs[a]=[]),this._beh_BehObjPairs[a].push([c,b]),console.log("returning behavior",c),"undefined"==typeof c.init&&(c.prototype.init=function(){}),c}return console.log("Behavior "+a+" has not been registered to JasperCore"),console.log("returning null"),null}},_createBehavior:function(a,b){return"string"==typeof a?hasOwnProperty(this._name_beh,a)?(console.log("Behavior name already present : "+a),null):(this._name_beh[a]=b,a):void 0},_deleteBehaviorFromObject:function(a,b){if(void 0!==this._beh_BehObjPairs[a])for(var c=this._beh_BehObjPairs[a].length,d=0;c>d;d++)if(this._beh_BehObjPairs[a][d][1].__obj_id==b.__obj_id)return this._beh_BehObjPairs[a].splice(d,1),void 0},_isNonUpdateBehavior:function(a){for(var b=this._nonUpdateBehaviors.length,c=0;b>c;c++)if(this._nonUpdateBehaviors[c]==a)return!0;return!1},_addNonUpdateBehavior:function(a){this._isNonUpdateBehavior(a)||this._nonUpdateBehaviors.push(a)},_getAllBehaviors:function(){var a=[];for(var b in this._name_beh)a.push(b);return a},_getBehArray:function(){return this._beh_BehObjPairs}},Jasper.CollisionManager=function(){this._layerNumber_Objects={},this._layerNum_QuadTree={},this._waitingList=[]},Jasper.CollisionManager.prototype={_registerCollidableObject:function(a){try{if(void 0===a.getLayer())return this._waitingList.push(a),void 0}catch(b){console.log(a)}if(void 0===this._layerNum_QuadTree[a.getLayer().getLayerNumber()]){var c={x:0,y:0,width:a.getLayer().getWorldSize().x,height:a.getLayer().getWorldSize().y};this._layerNum_QuadTree[a.getLayer().getLayerNumber()]=new QuadTree(c)}void 0===this._layerNumber_Objects[a.getLayer().getLayerNumber()]&&(this._layerNumber_Objects[a.getLayer().getLayerNumber()]=[]),this._hasAlreadyRegistered(a)===!1&&this._layerNumber_Objects[a.getLayer().getLayerNumber()].push(a)},_clearWaiting:function(a){len=this._waitingList.length;for(var b=0;len>b;b++)if(a===this._waitingList[b]){this._registerCollidableObject(a),this._waitingList.splice(b,1);break}},_hasAlreadyRegistered:function(a){objs=this._layerNumber_Objects[a.getLayer().getLayerNumber()],len=objs.length,registered=!1;for(var b=0;len>b;b++)a==objs[b]&&(registered=!0);return registered},calculateCollisions:function(){for(var a in this._layerNum_QuadTree){var b={x:0,y:0,width:1e3,height:1e3};tree=this._layerNum_QuadTree[a]=new QuadTree(b);var c=this._layerNumber_Objects[a].length;console.log("layer"+a+" objsinsert:"+c);for(var d=0;c>d;d++){var e=this._layerNumber_Objects[a][d];tree.insert({x:e.posX,y:e.posY,height:e.height,width:e.width,obj:e})}this._activateCollisionsInLayer(a)}},_activateCollisionsInLayer:function(a){for(var b=this._layerNumber_Objects[a].length,c=this._layerNum_QuadTree[a],d=0;b>d;d++){var e=this._layerNumber_Objects[a][d],f=c.retrieve({x:e.posX,y:e.posY,height:e.height,width:e.width}),g=f.length;console.log("insame layer"+g+" choildren count "+c.root.children.length);for(var h=0;g>h;h++)e.x<f[h].obj.x+f[h].obj.width&&e.x+e.width>f[h].obj.X1&&e.y<f[h].obj.y+f[h].obj.height&&e.y+e.height>f[h].obj.y&&e.getBehavior("collision").onCollide(f[h].obj)}}},Jasper.Core=function(){this.fps=60,this.running=!1,this.lastTime=0,this.canvas=null,this.canvasWidth=0,this.canvasHeight=0,this.canvasContext=null,this.scenes=[],this.activeScene=null,this.__next_objid=1,this.onInit=function(){}},Jasper.Core.prototype={_createCanvas:function(a,b){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvasWidth=a,this.canvas.height=this.canvasHeight=b,this.canvas.onmousemove=function(a){Jasper._mouseManager.mouseMove(a)},this.canvas.onmousedown=Jasper._mouseManager.mouseDown.bind(Jasper._mouseManager),this.canvas.onmouseup=Jasper._mouseManager.mouseUp.bind(Jasper._mouseManager),this.canvas.onclick=Jasper._mouseManager.mouseClick.bind(Jasper._mouseManager),this.canvas.ondblclick=Jasper._mouseManager.mouseDblClick.bind(Jasper._mouseManager),this.canvasContext=this.canvas.getContext("2d"),document.getElementById("container").appendChild(this.canvas)},_render:function(){this.canvasContext.save(),this.canvasContext.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.activeScene._render(this.canvasContext),this.canvasContext.restore()},_update:function(){currTime=(new Date).getTime(),elapsedTime=currTime-this.lastTime,this.lastTime=currTime,this.running&&requestAnimFrame(this._update.bind(this)),this.activeScene instanceof Jasper.Scene&&(this.activeScene._update(elapsedTime),Jasper._mouseManager._activateCallbacks(),Jasper._collisionManager.calculateCollisions(),this._render())},_start:function(){this.onInit(),this.lastTime=(new Date).getTime(),this.running=!0,requestAnimFrame(this._update.bind(this))},_getBehaviorManager:function(){return Jasper._behaviorManager},init:function(a){Jasper._mouseManager=new Jasper.Mouse,Jasper._behaviorManager=new Jasper.BehaviorManager,Jasper._spriteManager=new Jasper.SpriteManager,Jasper._collisionManager=new Jasper.CollisionManager,this._createCanvas(a.width,a.height),this.setFps(a.fps||30),Jasper._core=this,this._start()},getCanvas:function(){return this.canvas},getMouseManager:function(){return Jasper._mouseManager},addScene:function(a){-1==this.scenes.indexOf(a)&&this.scenes.push(a)},removeScene:function(a){if(this.activeScene==a)return console.log("Trying to remove currently active scene not permitted."),void 0;var b=this.scenes.indexOf(a);-1!=b&&this.scenes.splice(b,1)},removeSceneByName:function(a){if(this.activeScene.getSceneName()==a)return console.log("Trying to remove currently active scene not permitted."),void 0;for(var b=0;b<this.scenes.length;b++)this.scenes.getSceneName()==a&&this.scenes.splice(b,1)},getScenes:function(){return this.scenes},startScene:function(a){this.activeScene=a},endScene:function(){this.scenes.splice(this.scenes.indexOf(this.activeScene),1),this.activeScene=void 0},createBehavior:function(a,b,c){var d=Jasper.Behavior._createBehavior(b,c);return Jasper._behaviorManager._createBehavior(a,d)},setFps:function(a){fps=a}},Jasper.Layer=function(){this._scene=null,this._layerNumber=-1,this.worldSize={},this.viewportSize={},this.objects=[],this.numObjects=0,this.onInit=function(){},this.onUpdate=function(){},this.onDestroy=function(){}},Jasper.Layer.prototype={init:function(a){this.worldSize.x=a.worldX,this.worldSize.y=a.worldY},_update:function(a){this.onUpdate();for(var b=0;b<this.numObjects;b++)this.objects[b]._update(a)},_render:function(a){for(var b=0;b<this.numObjects;b++)this.objects[b]._render(a)},setWorldSize:function(a,b){this.worldSize.x=a,this.worldSize.y=b},getWorldSize:function(){return this.worldSize},setViewportSize:function(a,b){this.viewportSize.x=a,this.viewportSize.y=b},getViewportSize:function(){return this.viewportSize},addObject:function(a){a instanceof Jasper.Object?(a._layer=this,this.objects.push(a),a._onAddedToLayer(),this.numObjects++):console.log("Cannot add object of type : "+a.class+" ; needs JasperObject")},removeObject:function(){},getObjects:function(){return this.objects},getScene:function(){return this._scene},getLayerNumber:function(){return this._layerNumber}},Jasper.Object=function(a){this._id=Jasper.Object.ID++,this._layer=void 0,this._initWaiting=[],this._behaviors={},this._extraBehaviors={},this._rendererBehavior=null,this.visible=!1,this.posX=0,this.posY=0,this.height=0,this.width=0,this.worldX=0,this.worldY=0,this.rotation=0,this.alpha=0,this._name=a,this._scene=null},Jasper.Object.prototype={_update:function(a){if(this._initWaiting.length>0)for(var b=this._initWaiting.pop();void 0!==b;)b.init(),b=this._initWaiting.pop();for(var c in this._behaviors)this._behaviors[c].update(a)},_render:function(a){this._rendererBehavior instanceof Jasper.RenderableBehavior&&(this._rendererBehavior.renderBefore(a),this._rendererBehavior.render(a),this._rendererBehavior.renderAfter(a))},_onAddedToLayer:function(){Jasper._collisionManager._clearWaiting(this)},getPosX:function(){return this.posX},setPosX:function(a){this.posX=a},getPosY:function(){return this.posY},setPosY:function(a){this.posY=a},setPos:function(a,b){this.posX=a,this.posY=b},getAlpha:function(){return this.alpha},setAlpha:function(a){this.alpha=a},getLayer:function(){return this._layer},_addInitWaiting:function(a){this._initWaiting.push(a)},addBehavior:function(a){if("string"==typeof a){var b=Jasper._behaviorManager._addBehaviorToObject(a,this);if(b instanceof Jasper.Behavior)return b._parent=this,this._addInitWaiting(b),Jasper._behaviorManager._isNonUpdateBehavior(a)?(console.log("extra behavior found:"+a),this._extraBehaviors[a]=b):(this._behaviors[a]=b,b instanceof Jasper.RenderableBehavior&&(console.log("renderer found"),this._rendererBehavior=b)),b}},removeBehavior:function(a){Jasper._behaviorManager._deleteBehaviorFromObject(a,this),delete this._behaviors[a]},hasBehavior:function(a){return inNormalBehaviors=this._hasNormalBehavior(a),inExtraBehaviors=this._hasExtraBehavior(a),inNormalBehaviors||inExtraBehaviors},_hasNormalBehavior:function(a){return inNormalBehaviors=void 0!==this._behaviors[a]},_hasExtraBehavior:function(a){return inExtraBehaviors=void 0!==this._extraBehaviors[a]},getBehavior:function(a){return this._hasNormalBehavior(a)?this._behaviors[a]:this._hasExtraBehavior(a)?this._extraBehaviors[a]:void 0},setVisible:function(a){this.visible=a},isVisible:function(){return this.visible},setObjectRenderer:function(a){if(!(this._behaviors[a]instanceof Jasper.RendererBehavior))throw Error("Cannot add behavior "+a+" as objectRenderer. Not a RenderableBehavior");this._rendererBehavior=this._behaviors[a]},_getExtraBehaviors:function(){return this._extraBehaviors},_getAllBehaviors:function(){return this._behaviors}},Jasper.Object.ID=0,Jasper.Scene=function(a){this.sceneName=a,this.layerList=[],this.numLayers=0,this.onInit=function(){},this.onUpdate=function(){},this.onDestroy=function(){}},Jasper.Scene.prototype={_update:function(a){for(var b=0;b<this.numLayers;b++)this.onUpdate(),this.layerList[b]._update(a)},_render:function(a){for(var b=0;b<this.numLayers;b++)this.layerList[b]._render(a)},setSceneName:function(a){this.sceneName=a},getSceneName:function(){return this.sceneName},addLayer:function(a){a instanceof Jasper.Layer?(this.layerList.push(a),a.scene=this,a._layerNumber=this.numLayers,this.numLayers++):console.log("Cannot add object to scene. need Jasper.Layer")},getLayerWithNumber:function(a){len=this.layerList.length;for(var b=0;len>b;b++)if(layerList[b].getLayerNumber()==a)return layerList[b];return null}},Jasper.SpriteManager=function(){this._loadingCache={},this._spriteCache={},this._waitingBehaviors={},this._spriteNativeSizes={},this._spriteRegionRect={}},Jasper.SpriteManager.prototype={setSprite:function(a,b){if(void 0!==this._spriteCache[b])a._sprite=this._spriteCache[b],a._nativeWidth=this._spriteCache[b].width,a._nativeHeight=this._spriteCache[b].height,a._adjustDimensions(),a._loaded=!0;else if(void 0!==this._loadingCache[b])this._addToWaitingList(a,b);else{var c=new Image;c.spritePath=b,this._loadingCache[b]=c,this._addToWaitingList(a,b),c.onload=function(){var a=Jasper._spriteManager;a._spriteCache[c.spritePath]=this,delete a._loadingCache[c.spritePath],a._clearWaitingBehaviors(c.spritePath)},c.src=b}},_clearWaitingBehaviors:function(a){if(void 0!==this._waitingBehaviors[a]){for(var b=this._waitingBehaviors[a].pop();void 0!==b;)b._sprite=this._spriteCache[a],b._nativeWidth=this._spriteCache[a].width,b._nativeHeight=this._spriteCache[a].height,b._adjustDimensions(),b._loaded=!0,b=this._waitingBehaviors[a].pop();delete this._waitingBehaviors[a]}},_addToWaitingList:function(a,b){void 0===this._waitingBehaviors[b]&&(this._waitingBehaviors[b]=[]),this._waitingBehaviors[b].push(a)}},Jasper.Mouse=function(){this._events=[],this._onClickObjects=[],this._onMoveObjects=[],this._onDownObjects=[],this._onUpObjects=[],this._onDblClickObjects=[],this._callbackObjects=[],this._mousePos=[]},Jasper.Mouse.prototype={_existsCallbackObject:function(a){for(var b=this._callbackObjects.length,c=0;b>c;c++)if(a==this._callbackObjects[c])return c;return-1},getMousePos:function(){return this._mousePos},setMousePos:function(a,b){this._mousePos=[a,b]},mouseMove:function(a){this.setMousePos(a.offsetX,a.offsetY),this._events.push(["onMove",a.offsetX,a.offsetY])},mouseClick:function(a){console.log("inside mouseClick"),this._events.push(["onClick",a.offsetX,a.offsetY])},mouseDblClick:function(a){console.log("inside mouseDblClick"),this._events.push(["onDblClick",a.offsetX,a.offsetY])},mouseUp:function(a){console.log("inside mouseUp"),this._events.push(["onUp",a.offsetX,a.offsetY])},mouseDown:function(a){console.log("inside mouseDown"),this._events.push(["onDown",a.offsetX,a.offsetY])},registerOnClickObject:function(a){a instanceof Jasper.Object&&this._onClickObjects.push(a)},registerOnMoveObject:function(a){a instanceof Jasper.Object&&this._onMoveObjects.push(a)},registerOnDownObject:function(a){a instanceof Jasper.Object&&this._onDownObjects.push(a)},registerOnUpObject:function(a){a instanceof Jasper.Object&&this._onUpObjects.push(a)},registerOnDblClickObject:function(a){a instanceof Jasper.Object&&this._onDblClickObjects.push(a)},unregisterOnClickObject:function(a){if(a instanceof Jasper.Object)for(var b=this._onClickObjects.length,c=0;b>c;c++)if(this._onClickObjects[c]==object){this._onClickObjects.splice(c,1);break}},unregisterOnMoveObject:function(a){if(a instanceof Jasper.Object)for(var b=this._onMoveObjects.length,c=0;b>c;c++)if(this._onClickObjects[c]==object){this._onMoveObjects.splice(c,1);break}},unregisterOnDownObject:function(a){if(a instanceof Jasper.Object)for(var b=this._onDownObjects.length,c=0;b>c;c++)if(this._onClickObjects[c]==object){this._onDownObjects.splice(c,1);break}},unregisterOnUpObject:function(a){if(a instanceof Jasper.Object)for(var b=this._onUpObjects.length,c=0;b>c;c++)if(this._onClickObjects[c]==object){this._onUpObjects.splice(c,1);break}},unregisterOnDblClickObject:function(a){if(a instanceof Jasper.Object)for(var b=this._onDblClickObjects.length,c=0;b>c;c++)if(this._onClickObjects[c]==object){this._onDblClickObjects.splice(c,1);break}},registerCallbackObject:function(a){-1==this._existsCallbackObject(a)&&this._callbackObjects.push(a)},removeCallbackObject:function(a){var b=this._existsCallbackObject(a);-1!=b&&this._callbackObjects.splice(b,1)},_activateCallbacks:function(){for(var a=0,b=this._events.length,c=0;b>c;c++){var d=this._events[c][0],e=this._events[c][1],f=this._events[c][2],g=this["_"+d+"Objects"];a=g.length;for(var h=0;a>h;h++)g[h].getBehavior("mouse")[d](e,f)}this._events.length=0}},function(a){function b(a,b,e,f){var g;g=b?new c(a,0,e,f):new d(a,0,e,f),this.root=g}function c(a,b,c,d){this._bounds=a,this.children=[],this.nodes=[],d&&(this._maxChildren=d),c&&(this._maxDepth=c),b&&(this._depth=b)}function d(a,b,d,e){c.call(this,a,b,d,e),this._stuckChildren=[]}b.prototype.root=null,b.prototype.insert=function(a){if(a instanceof Array)for(var b=a.length,c=0;b>c;c++)this.root.insert(a[c]);else this.root.insert(a)},b.prototype.clear=function(){this.root.clear()},b.prototype.retrieve=function(a){var b=this.root.retrieve(a).slice(0);return b},c.prototype.nodes=null,c.prototype._classConstructor=c,c.prototype.children=null,c.prototype._bounds=null,c.prototype._depth=0,c.prototype._maxChildren=4,c.prototype._maxDepth=4,c.TOP_LEFT=0,c.TOP_RIGHT=1,c.BOTTOM_LEFT=2,c.BOTTOM_RIGHT=3,c.prototype.insert=function(a){if(this.nodes.length){var b=this._findIndex(a);return this.nodes[b].insert(a),void 0}this.children.push(a);var c=this.children.length;if(!(this._depth>=this._maxDepth)&&c>this._maxChildren){this.subdivide();for(var d=0;c>d;d++)this.insert(this.children[d]);this.children.length=0}},c.prototype.retrieve=function(a){if(this.nodes.length){var b=this._findIndex(a);return this.nodes[b].retrieve(a)}return this.children},c.prototype._findIndex=function(a){var b=this._bounds,d=a.x>b.x+b.width/2?!1:!0,e=a.y>b.y+b.height/2?!1:!0,f=c.TOP_LEFT;return d?e||(f=c.BOTTOM_LEFT):f=e?c.TOP_RIGHT:c.BOTTOM_RIGHT,f},c.prototype.subdivide=function(){var a=this._depth+1,b=this._bounds.x,d=this._bounds.y,e=0|this._bounds.width/2,f=0|this._bounds.height/2,g=b+e,h=d+f;this.nodes[c.TOP_LEFT]=new this._classConstructor({x:b,y:d,width:e,height:f},a),this.nodes[c.TOP_RIGHT]=new this._classConstructor({x:g,y:d,width:e,height:f},a),this.nodes[c.BOTTOM_LEFT]=new this._classConstructor({x:b,y:h,width:e,height:f},a),this.nodes[c.BOTTOM_RIGHT]=new this._classConstructor({x:g,y:h,width:e,height:f},a)},c.prototype.clear=function(){this.children.length=0;for(var a=this.nodes.length,b=0;a>b;b++)this.nodes[b].clear();this.nodes.length=0},d.prototype=new c,d.prototype._classConstructor=d,d.prototype._stuckChildren=null,d.prototype._out=[],d.prototype.insert=function(a){if(this.nodes.length){var b=this._findIndex(a),c=this.nodes[b];return a.x>=c._bounds.x&&a.x+a.width<=c._bounds.x+c._bounds.width&&a.y>=c._bounds.y&&a.y+a.height<=c._bounds.y+c._bounds.height?this.nodes[b].insert(a):this._stuckChildren.push(a),void 0}this.children.push(a);var d=this.children.length;if(!(this._depth>=this._maxDepth)&&d>this._maxChildren){this.subdivide();for(var e=0;d>e;e++)this.insert(this.children[e]);this.children.length=0}},d.prototype.getChildren=function(){return this.children.concat(this._stuckChildren)},d.prototype.retrieve=function(a){var b=this._out;if(b.length=0,this.nodes.length){var c=this._findIndex(a);b.push.apply(b,this.nodes[c].retrieve(a))}return b.push.apply(b,this._stuckChildren),b.push.apply(b,this.children),b},d.prototype.clear=function(){this._stuckChildren.length=0,this.children.length=0;var a=this.nodes.length;if(a){for(var b=0;a>b;b++)this.nodes[b].clear();this.nodes.length=0}},a.QuadTree=b}(window),Jasper.CircleDrawBehavior=function(){this.rad=0,this.strokeColor="black",this.strokeWidth=5,this.fillColor="black",this.fill=!0,this.stroke=!0},Jasper.CircleDrawBehavior.prototype=new Jasper.RenderableBehavior,Object.extend(Jasper.CircleDrawBehavior.prototype,{init:function(){},update:function(){},render:function(a){parent=this.getParentObject(),a.beginPath(),a.arc(Math.floor(parent.getPosX()),Math.floor(parent.getPosY()),this.rad,0,2*Math.PI,!0),this.fill&&(a.fillStyle=this.fillColor,a.fill()),this.stroke&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.stroke())},setRadius:function(a){return this.rad=a,this},setFillColor:function(a,b,c,d){return"string"==typeof a&&void 0===b&&void 0===c&&void 0===d?this.fillColor=a:void 0!==typeof a&&void 0!==b&&void 0!==c&&void 0===d?this.fillColor="rgba("+a+","+b+","+c+","+this.getParentObject().getAlpha()+")":void 0!==typeof a&&void 0!==b&&void 0!==c&&void 0!==d&&(this.getParentObject().setAlpha(d),this.fillColor="rgba("+a+","+b+","+c+","+d+")"),this},setFillEnabled:function(a){return this.fill=a,this},setStrokeEnabled:function(a){return this.stroke=a,this},setStrokeWidth:function(a){return this.strokeWidth=a,this}}),Jasper.CollisionBehavior=function(){this._collided=!1},Jasper.CollisionBehavior.prototype=new Jasper.Behavior,Object.extend(Jasper.CollisionBehavior.prototype,{init:function(){Jasper._behaviorManager._addNonUpdateBehavior("collision"),Jasper._collisionManager._registerCollidableObject(this.getParentObject())},setOnCollide:function(a){this.onCollide=a},onCollide:function(){}}),Jasper.MouseBehavior=function(){},Jasper.MouseBehavior.prototype=new Jasper.Behavior,Object.extend(Jasper.MouseBehavior.prototype,{init:function(){Jasper._behaviorManager._addNonUpdateBehavior("mouse")},onClick:function(){},onMove:function(){},onDown:function(){},onUp:function(){},onDblClick:function(){},setOnClick:function(a){return this.onClick=a,Jasper._mouseManager.registerOnClickObject(this.getParentObject()),this},setOnMove:function(a){return this.onMove=a,Jasper._mouseManager.registerOnMoveObject(this.getParentObject()),this},setOnDown:function(a){return this.onDown=a,Jasper._mouseManager.registerOnDownObject(this.getParentObject()),this},setOnUp:function(a){return this.onUp=a,Jasper._mouseManager.registerOnUpObject(this.getParentObject()),this},setOnDblClick:function(a){return this.onDblClick=a,Jasper._mouseManager.registerOnDblClickObject(this.getParentObject()),this},removeOnClick:function(){delete this.onClick,Jasper._mouseManager.unregisterOnClickObject(this.getParentObject())},removeOnMove:function(){delete this.onMove,Jasper._mouseManager.unregisterOnMoveObject(this.getParentObject())},removeOnDown:function(){delete this.onDown,Jasper._mouseManager.unregisterOnDownObject(this.getParentObject())},removeOnUp:function(){delete this.onUp,Jasper._mouseManager.unregisterOnUpObject(this.getParentObject())},removeOnDblClick:function(){delete this.onDblClick,Jasper._mouseManager.unregisterOnDblClickObject(this.getParentObject())}}),Jasper.RandomMoveBehavior=function(){this.finalx=Math.floor(500*Math.random()+1),this.finaly=Math.floor(500*Math.random()+1),this.initx=0,this.inity=0,this.elapsed=0},Jasper.RandomMoveBehavior.prototype=new Jasper.Behavior,Object.extend(Jasper.RandomMoveBehavior.prototype,{update:function(a){parent=this.getParentObject(),this.elapsed+=a,this.elapsed<2e4&&(parent.setPosX(Math.floor((this.finalx-this.initx)/2e4*this.elapsed)),parent.setPosY(Math.floor((this.finaly-this.inity)/2e4*this.elapsed)))}}),Jasper.RectangleDrawBehavior=function(){this.width=0,this.height=0,this.strokeColor="black",this.strokeWidth=5,this.fillColor="black",this.fill=!0,this.stroke=!0},Jasper.RectangleDrawBehavior.prototype=new Jasper.RenderableBehavior,Object.extend(Jasper.RectangleDrawBehavior.prototype,{init:function(){},update:function(){},render:function(a){parent=this.getParentObject(),this.fill&&(a.fillStyle=this.fillColor,a.fillRect(parent.posX,parent.posY,this.width,this.height)),this.stroke&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.strokeRect(parent.posX,parent.posY,this.width,this.height))},setWidth:function(a){return this.width=a,this},setHeight:function(a){return this.height=a,this},setFillColor:function(a,b,c,d){return"string"==typeof a&&void 0===b&&void 0===c&&void 0===d?this.fillColor=a:void 0!==typeof a&&void 0!==b&&void 0!==c&&void 0===d?this.fillColor="rgba("+a+","+b+","+c+","+this.getParentObject().getAlpha()+")":void 0!==typeof a&&void 0!==b&&void 0!==c&&void 0!==d&&(this.getParentObject().setAlpha(d),this.fillColor="rgba("+a+","+b+","+c+","+d+")"),this},setFillEnabled:function(a){return this.fill=a,this},setStrokeEnabled:function(a){return this.stroke=a,this},setStrokeWidth:function(a){return this.strokeWidth=a,this}}),Jasper.SpriteBehavior=function(){this._nativeWidth=0,this._nativeHeight=0,this._scaleX=1,this._scaleY=1,this._sprite=null,this._path="",this._loaded=!1,this._sprite=null,this._toAdjust=!1},Jasper.SpriteBehavior.prototype=new Jasper.RenderableBehavior,Object.extend(Jasper.SpriteBehavior.prototype,{init:function(){},update:function(){},render:function(a){this._loaded&&(parent=this.getParentObject(),a.drawImage(this._sprite,parent.posX,parent.posY,parent.width,parent.height))},setSprite:function(a){return this._path=a,Jasper._spriteManager.setSprite(this,this._path),this},setHeight:function(a){return this.getParentObject().height=Math.floor(a),this},setWidth:function(a){return this.getParentObject().width=Math.floor(a),this},getHeight:function(){return this.getParentObject.height},getWidth:function(){return this.getParentObject.width},getNativeHeight:function(){return this._nativeHeight},getNativeWidth:function(){return this._nativeWidth},setScaleX:function(a){return this._toAdjust=!0,this.getParentObject().width=Math.floor(this._nativeWidth*this._scaleX),this._scaleX=a,this},setScaleY:function(a){return this._toAdjust=!0,this.getParentObject().height=Math.floor(this._nativeHeight*this._scaleY),this._scaleY=a,this},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},_adjustDimensions:function(){this._toAdjust&&(parent=this.getParentObject(),parent.width=Math.floor(this._nativeWidth*this._scaleX),parent.height=Math.floor(this._nativeHeight*this._scaleY))}});